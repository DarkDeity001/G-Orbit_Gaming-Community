{"ast":null,"code":"import _asyncToGenerator from \"D:/Gamer`s Orbit/clips/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { of } from 'rxjs';\nimport { delay, map, filter, switchMap } from 'rxjs/operators';\nimport { NavigationEnd } from '@angular/router';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/fire/compat/auth\";\nimport * as i2 from \"@angular/fire/compat/firestore\";\nimport * as i3 from \"@angular/router\";\nexport class AuthService {\n  constructor(auth, db, router, route) {\n    this.auth = auth;\n    this.db = db;\n    this.router = router;\n    this.route = route;\n    this.redirect = false;\n    this.usersCollection = db.collection('users');\n    this.isAuthenticated$ = auth.user.pipe(map(user => !!user));\n    this.isAuthenticatedWithDelay$ = this.isAuthenticated$.pipe(delay(1000));\n    this.router.events.pipe(filter(e => e instanceof NavigationEnd), map(e => this.route.firstChild), switchMap(route => {\n      var _a;\n      return (_a = route === null || route === void 0 ? void 0 : route.data) !== null && _a !== void 0 ? _a : of({});\n    })).subscribe(data => {\n      var _a;\n      this.redirect = (_a = data.authOnly) !== null && _a !== void 0 ? _a : false;\n    });\n  }\n  createUser(userData) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      if (!userData.password) {\n        throw new Error(\"Password not provided!\");\n      }\n      const userCred = yield _this.auth.createUserWithEmailAndPassword(userData.email, userData.password);\n      if (!userCred.user) {\n        throw new Error(\"User can't be found\");\n      }\n      yield _this.usersCollection.doc(userCred.user.uid).set({\n        name: userData.name,\n        email: userData.email,\n        age: userData.age,\n        phoneNumber: userData.phoneNumber\n      });\n      yield userCred.user.updateProfile({\n        displayName: userData.name\n      });\n    })();\n  }\n  logout($event) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      if ($event) {\n        $event.preventDefault();\n      }\n      yield _this2.auth.signOut();\n      if (_this2.redirect) {\n        yield _this2.router.navigateByUrl('/');\n      }\n    })();\n  }\n}\nAuthService.ɵfac = function AuthService_Factory(t) {\n  return new (t || AuthService)(i0.ɵɵinject(i1.AngularFireAuth), i0.ɵɵinject(i2.AngularFirestore), i0.ɵɵinject(i3.Router), i0.ɵɵinject(i3.ActivatedRoute));\n};\nAuthService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: AuthService,\n  factory: AuthService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"names":["of","delay","map","filter","switchMap","NavigationEnd","AuthService","constructor","auth","db","router","route","redirect","usersCollection","collection","isAuthenticated$","user","pipe","isAuthenticatedWithDelay$","events","e","firstChild","_a","data","subscribe","authOnly","createUser","userData","_this","_asyncToGenerator","password","Error","userCred","createUserWithEmailAndPassword","email","doc","uid","set","name","age","phoneNumber","updateProfile","displayName","logout","$event","_this2","preventDefault","signOut","navigateByUrl","i0","ɵɵinject","i1","AngularFireAuth","i2","AngularFirestore","i3","Router","ActivatedRoute","factory","ɵfac","providedIn"],"sources":["D:\\Gamer`s Orbit\\clips\\src\\app\\services\\auth.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { AngularFireAuth } from '@angular/fire/compat/auth';\nimport { AngularFirestore, AngularFirestoreCollection } from '@angular/fire/compat/firestore';\nimport { Observable, of } from 'rxjs';\nimport IUser from '../models/user.model';\nimport { delay, map, filter, switchMap } from 'rxjs/operators'\nimport { Router } from '@angular/router';\nimport { ActivatedRoute, NavigationEnd } from '@angular/router';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n  private usersCollection: AngularFirestoreCollection<IUser>\n  public isAuthenticated$: Observable<boolean>\n  public isAuthenticatedWithDelay$: Observable<boolean>\n  private redirect = false\n\n  constructor(\n    private auth: AngularFireAuth,\n    private db: AngularFirestore,\n    private router: Router,\n    private route: ActivatedRoute\n  ) { \n    this.usersCollection = db.collection('users')\n    this.isAuthenticated$ = auth.user.pipe(\n      map(user => !!user)\n    )\n    this.isAuthenticatedWithDelay$ = this.isAuthenticated$.pipe(\n      delay(1000)\n    )\n    this.router.events.pipe(\n      filter(e => e instanceof NavigationEnd),\n      map(e => this.route.firstChild),\n      switchMap(route => route?.data ?? of({}))\n    ).subscribe(data => {\n      this.redirect = data.authOnly ?? false\n    })\n  }\n  \n  public async createUser(userData: IUser) {\n    if(!userData.password) {\n      throw new Error(\"Password not provided!\")\n    }\n\n    const userCred = await this.auth.createUserWithEmailAndPassword(\n      userData.email as string, userData.password as string\n    )\n\n    if(!userCred.user) {\n      throw new Error(\"User can't be found\")\n    }\n    \n    await this.usersCollection.doc(userCred.user.uid).set({\n      name: userData.name,\n      email: userData.email,\n      age: userData.age,\n      phoneNumber: userData.phoneNumber\n    })\n\n    await userCred.user.updateProfile({\n      displayName: userData.name\n    })\n  }\n\n  public async logout($event?: Event) {\n    if($event) {\n      $event.preventDefault()\n    }\n\n    await this.auth.signOut()\n\n    if(this.redirect) {\n      await this.router.navigateByUrl('/')\n    }\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}