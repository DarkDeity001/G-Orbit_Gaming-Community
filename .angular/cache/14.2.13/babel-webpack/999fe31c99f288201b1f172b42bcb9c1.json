{"ast":null,"code":"import _asyncToGenerator from \"D:/Gamer`s Orbit/clips/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { v4 as uuid } from 'uuid';\nimport { last, switchMap } from 'rxjs/operators';\nimport firebase from 'firebase/compat/app';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/fire/compat/storage\";\nimport * as i2 from \"@angular/fire/compat/auth\";\nimport * as i3 from \"src/app/services/clip.service\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"../../shared/input/input.component\";\nimport * as i7 from \"../../shared/alert/alert.component\";\nimport * as i8 from \"../../shared/directives/event-blocker.directive\";\nimport * as i9 from \"@angular/forms\";\n\nconst _c0 = function (a0) {\n  return {\n    \"bg-indigo-400 border-indigo-400 border-solid\": a0\n  };\n};\n\nfunction UploadComponent_ng_container_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 5);\n    i0.ɵɵlistener(\"dragend\", function UploadComponent_ng_container_4_Template_div_dragend_1_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.isDragover = false);\n    })(\"dragover\", function UploadComponent_ng_container_4_Template_div_dragover_1_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.isDragover = true);\n    })(\"dragenter\", function UploadComponent_ng_container_4_Template_div_dragenter_1_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.isDragover = true);\n    })(\"dragleave\", function UploadComponent_ng_container_4_Template_div_dragleave_1_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.isDragover = false);\n    })(\"mouseleave\", function UploadComponent_ng_container_4_Template_div_mouseleave_1_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r8 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r8.isDragover = false);\n    })(\"drop\", function UploadComponent_ng_container_4_Template_div_drop_1_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.storeFile($event));\n    });\n    i0.ɵɵelementStart(2, \"h5\");\n    i0.ɵɵtext(3, \"Drop your file here (mp4 only!)\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"input\", 6);\n    i0.ɵɵlistener(\"change\", function UploadComponent_ng_container_4_Template_input_change_4_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.storeFile($event));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(1, _c0, ctx_r0.isDragover));\n  }\n}\n\nfunction UploadComponent_ng_template_5_app_alert_0_p_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"percent\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r12 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(2, 1, ctx_r12.percentage));\n  }\n}\n\nfunction UploadComponent_ng_template_5_app_alert_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"app-alert\", 21)(1, \"p\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, UploadComponent_ng_template_5_app_alert_0_p_3_Template, 3, 3, \"p\", 22);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r11 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"color\", ctx_r11.alertColor);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r11.alertMsg);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r11.showPercentage);\n  }\n}\n\nconst _c1 = function (a0, a1) {\n  return {\n    \"opacity-50\": a0,\n    \"hover:bg-indigo-700\": a1\n  };\n};\n\nfunction UploadComponent_ng_template_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵtemplate(0, UploadComponent_ng_template_5_app_alert_0_Template, 4, 3, \"app-alert\", 7);\n    i0.ɵɵelementStart(1, \"form\", 8);\n    i0.ɵɵlistener(\"ngSubmit\", function UploadComponent_ng_template_5_Template_form_ngSubmit_1_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.uploadFile());\n    });\n    i0.ɵɵelementStart(2, \"h2\", 9);\n    i0.ɵɵtext(3, \"Select a Thumbnail\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 10)(5, \"div\", 11);\n    i0.ɵɵelement(6, \"img\", 12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 13);\n    i0.ɵɵelement(8, \"img\", 14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"div\", 13);\n    i0.ɵɵelement(10, \"img\", 15);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"div\", 16)(12, \"label\", 17);\n    i0.ɵɵtext(13, \"Title\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(14, \"app-input\", 18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"div\", 19)(16, \"button\", 20);\n    i0.ɵɵtext(17, \" Publish \");\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.showAlert);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"formGroup\", ctx_r2.uploadForm);\n    i0.ɵɵadvance(13);\n    i0.ɵɵproperty(\"control\", ctx_r2.title);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r2.inSubmission)(\"ngClass\", i0.ɵɵpureFunction2(5, _c1, ctx_r2.inSubmission, !ctx_r2.inSubmission));\n  }\n}\n\nexport let UploadComponent = /*#__PURE__*/(() => {\n  class UploadComponent {\n    constructor(storage, auth, clipsService, router) {\n      this.storage = storage;\n      this.auth = auth;\n      this.clipsService = clipsService;\n      this.router = router;\n      this.isDragover = false;\n      this.file = null;\n      this.nextStep = false;\n      this.showAlert = false;\n      this.alertColor = 'blue';\n      this.alertMsg = 'Please wait! Your clip is being uploaded.';\n      this.inSubmission = false;\n      this.percentage = 0;\n      this.showPercentage = false;\n      this.user = null;\n      this.title = new FormControl('', {\n        validators: [Validators.required, Validators.minLength(3)],\n        nonNullable: true\n      });\n      this.uploadForm = new FormGroup({\n        title: this.title\n      });\n      auth.user.subscribe(user => this.user = user);\n    }\n\n    ngOnDestroy() {\n      var _a;\n\n      (_a = this.task) === null || _a === void 0 ? void 0 : _a.cancel();\n    }\n\n    storeFile($event) {\n      var _a, _b, _c, _d;\n\n      this.isDragover = false;\n      this.file = $event.dataTransfer ? (_b = (_a = $event.dataTransfer) === null || _a === void 0 ? void 0 : _a.files.item(0)) !== null && _b !== void 0 ? _b : null : (_d = (_c = $event.target.files) === null || _c === void 0 ? void 0 : _c.item(0)) !== null && _d !== void 0 ? _d : null;\n\n      if (!this.file || this.file.type !== 'video/mp4') {\n        return;\n      }\n\n      this.title.setValue(this.file.name.replace(/\\.[^/.]+$/, ''));\n      this.nextStep = true;\n    }\n\n    uploadFile() {\n      var _this = this;\n\n      this.uploadForm.disable();\n      this.showAlert = true;\n      this.alertColor = 'blue';\n      this.alertMsg = 'Please wait! Your clip is being uploaded.';\n      this.inSubmission = true;\n      this.showPercentage = true;\n      const clipFileName = uuid();\n      const clipPath = `clips/${clipFileName}.mp4`;\n      this.task = this.storage.upload(clipPath, this.file);\n      const clipRef = this.storage.ref(clipPath);\n      this.task.percentageChanges().subscribe(progress => {\n        this.percentage = progress / 100;\n      });\n      this.task.snapshotChanges().pipe(last(), switchMap(() => clipRef.getDownloadURL())).subscribe({\n        next: function () {\n          var _ref = _asyncToGenerator(function* (url) {\n            var _a, _b;\n\n            const clip = {\n              uid: (_a = _this.user) === null || _a === void 0 ? void 0 : _a.uid,\n              displayName: (_b = _this.user) === null || _b === void 0 ? void 0 : _b.displayName,\n              title: _this.title.value,\n              fileName: `${clipFileName}.mp4`,\n              url,\n              timestamp: firebase.firestore.FieldValue.serverTimestamp()\n            };\n            const clipDocRef = yield _this.clipsService.createClip(clip);\n            console.log(clip);\n            _this.alertColor = 'green';\n            _this.alertMsg = 'Success! Your clip is now ready to share with the world.';\n            _this.showPercentage = false;\n            setTimeout(() => {\n              _this.router.navigate(['clip', clipDocRef.id]);\n            }, 1000);\n          });\n\n          return function next(_x) {\n            return _ref.apply(this, arguments);\n          };\n        }(),\n        error: error => {\n          this.uploadForm.enable();\n          this.alertColor = 'red';\n          this.alertMsg = 'Upload failed! Please try again later.';\n          this.inSubmission = true;\n          this.showPercentage = false;\n          console.error(error);\n        }\n      });\n    }\n\n  }\n\n  UploadComponent.ɵfac = function UploadComponent_Factory(t) {\n    return new (t || UploadComponent)(i0.ɵɵdirectiveInject(i1.AngularFireStorage), i0.ɵɵdirectiveInject(i2.AngularFireAuth), i0.ɵɵdirectiveInject(i3.ClipService), i0.ɵɵdirectiveInject(i4.Router));\n  };\n\n  UploadComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: UploadComponent,\n    selectors: [[\"app-upload\"]],\n    decls: 7,\n    vars: 2,\n    consts: [[1, \"container\", \"mx-auto\", \"my-8\", \"bg-secondary\", \"p-6\"], [1, \"rounded\", \"relative\", \"flex\", \"flex-col\"], [1, \"font-bold\", \"mb-6\"], [4, \"ngIf\", \"ngIfElse\"], [\"uploadFormCtr\", \"\"], [\"app-event-blocker\", \"\", 1, \"w-full\", \"px-10\", \"py-40\", \"rounded\", \"text-center\", \"cursor-pointer\", \"border\", \"border-dashed\", \"border-gray-400\", \"transition\", \"duration-500\", \"hover:text-white\", \"hover:bg-indigo-400\", \"hover:border-indigo-400\", \"hover:border-solid\", \"text-xl\", 3, \"ngClass\", \"dragend\", \"dragover\", \"dragenter\", \"dragleave\", \"mouseleave\", \"drop\"], [\"type\", \"file\", 1, \"mt-4\", 3, \"change\"], [3, \"color\", 4, \"ngIf\"], [3, \"formGroup\", \"ngSubmit\"], [1, \"mb-4\", \"text-xl\"], [1, \"grid\", \"grid-cols-1\", \"lg:grid-cols-3\", \"gap-4\"], [1, \"border-8\", \"cursor-pointer\", \"border-green-400\"], [\"src\", \"assets/img/1.jpg\"], [1, \"border-8\", \"cursor-pointer\", \"border-transparent\"], [\"src\", \"assets/img/2.jpg\"], [\"src\", \"assets/img/3.jpg\"], [1, \"mt-4\"], [1, \"block\", \"text-xl\", \"mb-4\"], [\"placeholder\", \"Enter Title\", 3, \"control\"], [1, \"mt-4\", \"text-right\"], [\"type\", \"submit\", 1, \"inline-flex\", \"justify-center\", \"py-2\", \"px-4\", \"border\", \"border-transparent\", \"shadow-sm\", \"rounded-md\", \"text-white\", \"bg-indigo-600\", \"focus:outline-none\", 3, \"disabled\", \"ngClass\"], [3, \"color\"], [4, \"ngIf\"]],\n    template: function UploadComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"section\", 0)(1, \"div\", 1)(2, \"div\", 2);\n        i0.ɵɵtext(3, \"Upload Video\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(4, UploadComponent_ng_container_4_Template, 5, 3, \"ng-container\", 3);\n        i0.ɵɵtemplate(5, UploadComponent_ng_template_5_Template, 18, 8, \"ng-template\", null, 4, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵelementEnd()();\n      }\n\n      if (rf & 2) {\n        const _r1 = i0.ɵɵreference(6);\n\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngIf\", !ctx.nextStep)(\"ngIfElse\", _r1);\n      }\n    },\n    dependencies: [i5.NgClass, i5.NgIf, i6.InputComponent, i7.AlertComponent, i8.EventBlockerDirective, i9.ɵNgNoValidate, i9.NgControlStatusGroup, i9.FormGroupDirective, i5.PercentPipe]\n  });\n  return UploadComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}